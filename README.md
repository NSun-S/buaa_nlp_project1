## 深度学习与自然语言处理第一次作业

<p align='right'> <strong>SY2106318 孙旭东 </strong></p>

**详细技术报告见**[SY2106318-深度学习和自然语言处理第一次作业](https://github.com/NSun-S/buaa_nlp_project1/raw/main/SY2106318-深度学习和自然语言处理第一次作业.pdf)

### 程序简介

#### 程序运行

运行main.py即可得到结果展示部分对应内容。

#### 主要模块介绍

```python
def get_single_corpus(file_path):
    """
    获取file_path文件对应的内容
    :return: file_path文件处理结果
    """
    corpus = ''
    # unuseful items filter
    r1 = u'[a-zA-Z0-9’!"#$%&\'()*+,-./:：;<=>?@，。?★、…【】《》？“”‘’！[\\]^_`{|}~「」『』（）]+'
    with open(file_path, 'r', encoding='ANSI') as f:
        corpus = f.read()
        corpus = re.sub(r1, '', corpus)
        corpus = corpus.replace('\n', '')
        corpus = corpus.replace('\u3000', '')
        corpus = corpus.replace('本书来自免费小说下载站更多更新免费电子书请关注', '')
        f.close()
    return corpus
```

这一函数读取file_path路径下对应的文件，并对文件内容进行处理，去除所有非中文字符及与小说内容无关的内容，返回字符串格式的文章。

```python
def get_tf(tf_dic, words):
    """
    获取一元词词频
    :return:一元词词频dic
    """
    for i in range(len(words)):
        tf_dic[words[i]] = tf_dic.get(words[i], 0) + 1


def get_bigram_tf(tf_dic, words):
    """
    获取二元词词频
    :return:二元词词频dic
    """
    for i in range(len(words)-1):
        tf_dic[(words[i], words[i+1])] = tf_dic.get((words[i], words[i+1]), 0) + 1


def get_trigram_tf(tf_dic, words):
    """
    获取二元词词频
    :return:二元词词频dic
    """
    for i in range(len(words)-2):
        tf_dic[((words[i], words[i+1]), words[i+2])] = tf_dic.get(((words[i], words[i+1]), words[i+2]), 0) + 1
```

这三个函数为获取词频字典使用的函数，其功能分别为获取一元词词频、二元词词频和三元词词频。

```python
def calculate_trigram_entropy(bigram_tf_dic, trigram_tf_dic, len_data):
    """
    计算三元词的信息熵
    :return:
    """
    begin = time.time()
    tri_words_num = sum([item[1] for item in trigram_tf_dic.items()])
    avg_word_len = sum(len(item[0][i]) for item in trigram_tf_dic.items() for i in range(len(item[0])))/len(trigram_tf_dic)

    print("分词个数：{}".format(tri_words_num))
    print('不同词个数：{}'.format((len(trigram_tf_dic))))
    print("平均词长：{:.6f}".format(avg_word_len))

    entropy = 0
    for tri_item in trigram_tf_dic.items():
        jp = tri_item[1] / tri_words_num
        cp = tri_item[1] / bigram_tf_dic[tri_item[0][0]]
        entropy += -jp * math.log(cp, 2)
    print("基于分词的三元模型中文信息熵为：{:.6f} 比特/词".format(entropy))

    end = time.time()
    print("三元模型运行时间：{:.6f} s".format(end - begin))
    return ['trigram', len_data, len(trigram_tf_dic), round(avg_word_len, 6), round(entropy, 6)]
```

以三元信息熵的计算说明信息熵计算过程，输入参数为”二元词频字典“、”三元词频字典“和”语料库长度“，平均词长的计算原则为所有不同词的长度之和除以所有不同词的计数。信息熵的计算则对三元词频字典中每个键（key）计算联合概率密度和条件概率密度，然后进行熵值的累加。

其余代码见本仓库main.py和dataPrepare.py。

### 结果展示

#### 金庸小说全集（16本）信息熵表（分词模式）

| #    | 分词模型 | 语料字数 | 分词个数 | 平均词长 | 信息熵（比特/词） |
| ---- | -------- | -------- | -------- | -------- | ----------------- |
| 1    | unigram  | 7282998  | 172676   | 1.696304 | 12.172905         |
| 2    | bigram   | 7282998  | 1982472  | 3.87425  | 6.962872          |
| 3    | trigram  | 7282998  | 3575450  | 3.749168 | 2.302969          |

#### 金庸小说全集（16本）信息熵表（字符模式）
| #    | 分词模型 | 语料字数 | 分词个数 | 平均词长 | 信息熵（比特/词） |
| ---- | -------- | -------- | -------- | -------- | ----------------- |
| 1    | unigram  | 7282998  | 5778     | 1.0      | 9.534901          |
| 2    | bigram   | 7282998  | 738777   | 2.0      | 6.734948          |
| 3    | trigram  | 7282998  | 3223048  | 3.0      | 3.951713          |

#### 金庸小说单本信息熵表（分词模式）
| #    | 小说名       | 语料字数 | 一元分词个数 | 一元平均词长 | 一元模型信息熵（比特/词） | 二元分词个数 | 二元平均词长 | 二元模型信息熵（比特/词） | 三元分词个数 | 三元平均词长 | 三元模型信息熵（比特/词） |
| ---- | ------------ | -------- | ------------ | ------------ | ------------------------- | ------------ | ------------ | ------------------------- | ------------ | ------------ | ------------------------- |
| 1    | 三十三剑客图 | 53399    | 11275        | 1.706584     | 11.681066                 | 27817        | 3.50541      | 2.94602                   | 30791        | 3.710272     | 0.272666                  |
| 2    | 书剑恩仇录   | 435906   | 33902        | 1.719598     | 11.719617                 | 173944       | 3.69462      | 5.02564                   | 237891       | 3.735568     | 1.038883                  |
| 3    | 侠客行       | 309887   | 23552        | 1.689936     | 11.188972                 | 119942       | 3.65776      | 4.955795                  | 169198       | 3.71028      | 1.12706                   |
| 4    | 倚天屠龙记   | 818422   | 46720        | 1.723059     | 11.760183                 | 295229       | 3.755288     | 5.518218                  | 434036       | 3.746558     | 1.328639                  |
| 5    | 天龙八部     | 1021603  | 54701        | 1.689835     | 11.736275                 | 358425       | 3.73121      | 5.677541                  | 542047       | 3.721688     | 1.480923                  |
| 6    | 射雕英雄传   | 767899   | 49168        | 1.699441     | 11.834495                 | 289349       | 3.702895     | 5.469081                  | 417279       | 3.722929     | 1.266258                  |
| 7    | 白马啸西风   | 57437    | 7167         | 1.633729     | 10.242509                 | 25842        | 3.458401     | 3.991294                  | 33355        | 3.64551      | 0.741034                  |
| 8    | 碧血剑       | 416533   | 34049        | 1.714982     | 11.747485                 | 169603       | 3.675837     | 4.996851                  | 229135       | 3.730325     | 0.993505                  |
| 9    | 神雕侠侣     | 827823   | 49026        | 1.659795     | 11.561237                 | 302521       | 3.666545     | 5.671443                  | 454349       | 3.687681     | 1.434044                  |
| 10   | 笑傲江湖     | 824948   | 41587        | 1.709397     | 11.398787                 | 277816       | 3.760651     | 5.618827                  | 429486       | 3.738958     | 1.527482                  |
| 11   | 越女剑       | 13663    | 2981         | 1.694531     | 10.072456                 | 6996         | 3.455689     | 2.529249                  | 7890         | 3.695691     | 0.328286                  |
| 12   | 连城诀       | 194542   | 17719        | 1.659094     | 11.043223                 | 81134        | 3.566631     | 4.691516                  | 110400       | 3.672726     | 0.955575                  |
| 13   | 雪山飞狐     | 113428   | 13243        | 1.685158     | 11.110252                 | 50502        | 3.571918     | 4.110558                  | 63759        | 3.696545     | 0.693631                  |
| 14   | 飞狐外传     | 375225   | 28917        | 1.698327     | 11.528414                 | 149762       | 3.661817     | 4.994856                  | 206556       | 3.715399     | 1.053167                  |
| 15   | 鸳鸯刀       | 29290    | 5143         | 1.705584     | 10.478126                 | 14191        | 3.540342     | 3.085121                  | 16662        | 3.709279     | 0.432056                  |
| 16   | 鹿鼎记       | 1022993  | 49960        | 1.694323     | 11.447505                 | 338794       | 3.740019     | 5.752031                  | 531493       | 3.728335     | 1.619806                  |

#### 金庸小说单本信息熵表（字符模式）
| #    | 小说名       | 语料字数 | 一元分词个数 | 一元平均词长 | 一元模型信息熵（比特/词） | 二元分词个数 | 二元平均词长 | 二元模型信息熵（比特/词） | 三元分词个数 | 三元平均词长 | 三元模型信息熵（比特/词） |
| ---- | ------------ | -------- | ------------ | ------------ | ------------------------- | ------------ | ------------ | ------------------------- | ------------ | ------------ | ------------------------- |
| 1    | 三十三剑客图 | 53399    | 2765         | 1.0          | 9.67383                   | 33571        | 2.0          | 4.833181                  | 48807        | 3.0          | 0.98232                   |
| 2    | 书剑恩仇录   | 435906   | 3938         | 1.0          | 9.472801                  | 132520       | 2.0          | 5.77677                   | 307362       | 3.0          | 2.389521                  |
| 3    | 侠客行       | 309887   | 3228         | 1.0          | 9.154881                  | 91480        | 2.0          | 5.58955                   | 212851       | 3.0          | 2.368499                  |
| 4    | 倚天屠龙记   | 818422   | 3936         | 1.0          | 9.395247                  | 188663       | 2.0          | 6.020465                  | 515464       | 3.0          | 2.804452                  |
| 5    | 天龙八部     | 1021603  | 4253         | 1.0          | 9.407149                  | 220114       | 2.0          | 6.124654                  | 623797       | 3.0          | 2.948488                  |
| 6    | 射雕英雄传   | 767899   | 4415         | 1.0          | 9.448709                  | 191252       | 2.0          | 6.060441                  | 503227       | 3.0          | 2.756466                  |
| 7    | 白马啸西风   | 57437    | 2157         | 1.0          | 8.913669                  | 25202        | 2.0          | 4.581347                  | 45324        | 3.0          | 1.619834                  |
| 8    | 碧血剑       | 416533   | 3954         | 1.0          | 9.45911                   | 131965       | 2.0          | 5.864349                  | 301439       | 3.0          | 2.349298                  |
| 9    | 神雕侠侣     | 827823   | 3921         | 1.0          | 9.327852                  | 189553       | 2.0          | 6.114244                  | 531946       | 3.0          | 2.887035                  |
| 10   | 笑傲江湖     | 824948   | 3819         | 1.0          | 9.209128                  | 172468       | 2.0          | 5.896344                  | 486098       | 3.0          | 2.869852                  |
| 11   | 越女剑       | 13663    | 1420         | 1.0          | 8.82653                   | 8568         | 2.0          | 3.641473                  | 11978        | 3.0          | 0.910077                  |
| 12   | 连城诀       | 194542   | 2999         | 1.0          | 9.173805                  | 67150        | 2.0          | 5.397629                  | 143673       | 3.0          | 2.156446                  |
| 13   | 雪山飞狐     | 113428   | 2724         | 1.0          | 9.205488                  | 47260        | 2.0          | 5.161323                  | 89260        | 3.0          | 1.757219                  |
| 14   | 飞狐外传     | 375225   | 3420         | 1.0          | 9.310561                  | 112083       | 2.0          | 5.752678                  | 262785       | 3.0          | 2.406082                  |
| 15   | 鸳鸯刀       | 29290    | 1912         | 1.0          | 9.036094                  | 16358        | 2.0          | 4.214057                  | 24918        | 3.0          | 1.116929                  |
| 16   | 鹿鼎记       | 1022993  | 4212         | 1.0          | 9.291481                  | 210494       | 2.0          | 5.985501                  | 597000       | 3.0          | 2.949062                  |

### 结论

1. 中英文对比：本实验中计算出在分词模式下，一元词的信息熵为12.17bit，在字符模式下，单个字的信息熵为9.53bit，而论文中提出的模型计算出的英文单个词信息熵为1.75bit，这一点说明，无论是以字为单位还是词为单位，中文的信息熵都要比英文高，即中文混乱程度更高，包含的信息量也更多。
2. N-gram对比：在分词模式下，一元词的信息熵为12.17bit，二元词的信息熵为6.96bit，三元词的信息熵为2.30bit，可以看出随着N的增大，平均信息熵在下降，这是因为N取值越大，通过分词后得到的文本中词组的分布就越简单，N越大使得固定的词数量越多，固定的词能减少由字或者短词打乱文章的机会，使得文章变得更加有序，减少了由字组成词和组成句的不确定性，也即减少了文本的信息熵，符合实际认知。但在分字符模式下，一元字符的信息熵为9.53bit，二元字符的信息熵为6.73bit，三元字符的信息熵为3.59bit，也符合上述规律。
3. 两种模式对比：分词模式在一元和二元下得到的信息熵比分字符模式更高，而在三元时得到的信息熵比分字符模式更低，由分词个数我们可以发现其背后的原因，在分词模式下，一元词的数目远大于一元字符的数目，这是由于不同字符组合成词的方式非常多样，这就导致了词这一单位信息熵的增大，而当N增大时，由于词与词之间常常有一些固定的组合搭配，会形成一些固定的意思，这就使得整体的信息熵降了下来，而对于字符，虽然也有同样的趋势，字符间的组合往往比词语的组合要更加随机，因此在三元时，分字符模式的信息熵要比分词模式高。

### 参考文档

[中文信息熵的计算_DiliDili_Q的博客](https://blog.csdn.net/weixin_42663984/article/details/115718241)

[中文平均信息熵 | 稷殿下 ](https://kangleizhou.github.io/nlp/2021/04/08/Chinese_entropy/)

[中文平均信息熵的计算_zxycurry的博客](https://blog.csdn.net/weixin_50891266/article/details/115723958)